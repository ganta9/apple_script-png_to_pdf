# PNG to PDF 変換ツール 仕様書





## 1. 概要
本アプリケーションは、macOS上でAppleScriptにより実装されたPNG画像からPDF変換ツールです。指定フォルダ内のPNG画像ファイルを一括でPDFファイルに変換する機能を提供し、**200MB自動分割機能**により大容量ファイルも効率的に処理できます。v4.0では**完全な横向きPDF対応**を実現しました。

### 1.1 目的
- PNG画像を効率的にPDF化
- バッチ処理による複数画像の一括変換
- ユーザーフレンドリーなGUIインターフェース


## 主要機能

### 1. 実行時ページサイズ選択
ユーザーは以下の2種類のページサイズから選択可能：

| ページサイズ | 寸法（縦向き） | 用途 |
|-------------|-------------|------|
| A4 | 210×297mm | 標準的な文書サイズ |
| A3 | 297×420mm | 大判文書、ポスター |

### 2. 実行時向き選択
- **縦（Portrait）**: 標準的な縦向きレイアウト
- **横（Landscape）**: 実際のPDFページが横向きレイアウト（842x595mm A4横、1191x842mm A3横）

#### 横向きPDF技術仕様
- **ImageMagickアプローチ**: オフセット付きページサイズ指定（`-page 842x595+0+0`）
- **完全な横向きページ**: PDFビューアで開いた際にページ自体が横向き表示
- **バッチ処理対応**: 複数PNGファイルの一括横向きPDF作成
- **高品質**: 画質劣化なし、解像度維持

### 3. 200MB自動分割機能（v2.0継承）
- ファイルサイズが200MBを超える場合、自動的に小さなバッチに分割
- 分割されたファイルは連番付きで保存（例：`document_part1.pdf`, `document_part2.pdf`）

## システム要件

### 必須環境
- **OS**: macOS (AppleScript対応版)

## ユーザーインターフェース

### 実行フロー
1. **ファイル名入力ダイアログ**
   - PDFファイル名を入力（.pdf拡張子は自動付与）

2. **ページサイズ選択ダイアログ**
   - 2種類のページサイズから選択
   - デフォルト：A4

3. **向き選択ダイアログ**
   - 縦（Portrait）または横（Landscape）から選択
   - デフォルト：縦

4. **設定確認画面**
   - 選択した設定を表示
   - ファイル数、画質、ページサイズ、向きを確認

5. **変換実行**
   - バッチ処理で PNG → PDF変換

6. **結果表示**
   - 作成されたPDFファイル情報
   - ファイルサイズと保存場所

## 設定仕様

### 基本設定（ハードコード）
```applescript
set sourceFolder to "/Users/gantaku/本/_screenshot/"  -- 入力フォルダ
set saveFolder to "/Users/gantaku/本/"               -- 出力フォルダ
set imageQuality to "85"                            -- 画質(1-100)
set fitToPage to true                               -- ページフィット
set maxFileSize to 200                              -- 最大サイズ(MB)
```

### 可変設定（実行時選択）
- **ページサイズ**: A4, A3
- **向き**: Portrait（縦）, Landscape（横）

## 技術仕様


### 分割処理アルゴリズム
1. **サイズチェック**: 作成後にファイルサイズを確認
2. **分割条件**: 200MB超過時

## ファイル構成
```
versions/v4.0_page_settings/
├── main.applescript      # ソースコード
├── main.scpt            # コンパイル済み実行ファイル
└── VERSION_INFO.md      # バージョン情報

docs/
├── PNG_to_PDF_仕様書.md                    # 本仕様書
└── ImageMagickによる横向きPDF実装_完全ガイド.md  # 横向きPDF実装の技術資料
```

## 実行方法
```bash
# コマンドライン実行
osascript versions/v4.0_page_settings/main.scpt

# Finder から実行
# main.scpt をダブルクリック
```

## エラーハンドリング

### 一般的なエラー
- **ImageMagick未検出**: インストール手順を表示
- **PNGファイル未検出**: フォルダ確認メッセージ
- **ユーザーキャンセル**: 処理中止メッセージ
- **変換失敗**: 設定確認メッセージ

## 技術的知見と制約

### 横向きPDF実装について
v4.0での横向きPDF実装は、複数の失敗事例を経て最終的に成功しました。技術的な詳細は以下のドキュメントを参照してください：
- `docs/ImageMagickによる横向きPDF実装_完全ガイド.md`

### 成功要因
1. **正確なページサイズ指定**: A4横向き=842x595、A3横向き=1191x842
2. **オフセット指定**: `-page 842x595+0+0` でImageMagickに画像配置を明示
3. **シンプルなアプローチ**: 複雑な回転処理を避けた直接的なページサイズ変更

## バージョン履歴
- **v1.0**: 基本的なPNG→PDF変換
- **v2.0**: 200MB自動分割機能追加
- **v3.0**: ページサイズ選択機能（縦向きのみ）
- **v4.0**: 完全な横向きPDF対応実現

